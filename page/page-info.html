<!DOCTYPE html>
<html>

<head>
   <meta name="viewport" content="width = device-width, initial-scale = 1">
   <meta charset="UTF-8">
   <title></title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link rel="stylesheet" type="text/css" href="/style.css">
   <script src="https://kit.fontawesome.com/ee8945d5d6.js" crossorigin="anonymous"></script>
</head>

<body>
   <header>
      <label for="bars">
         <i class="fas fa-bars" id="bars"></i>
      </label>
      <label for="webtitle">
         <h3>EsNovels</h3>
      </label>
      <label for="search-icon">
         <i class="fa-solid fa-magnifying-glass"></i>
      </label>
   </header>
   <nav id="navbar">
      <ul>
         <li><a href="">Home</a></li>
         <li><a href="">Light Novels</a></li>
         <li><a href="">Web Novels</a></li>
         <li><a href="">Korean Novels</a></li>
         <li><a href="">Contact</a></li>
         <li><a href="">Support</a></li>
      </ul>
   </nav>
   <div class="search-container">
      <input type="search" id="search" placeholder="Search Novel" />
   </div>
   <div class="container">

      <div cclass="info-page">

         <div class="page-cover-container">

            <img alt="Cover" id="cover" loading="lazy" />
            <h3 id="title"></h3>
            <button type="button" id="addToFav"><i class="fa-solid fa-heart"></i> Add To Favorite</button>
         </div>

         <div class="information">
            <div class="info"><span>Type: </span><span id="type"></span></div>
            <div class="info"><span>Genres: </span><span id="genres"></span></div>
            <div class="info"><span>Synopsis </span><br /><span id="synopsis"></span></div>



         </div>

         <div class="volumes-container">
            <h3>Download Volumes</h3>
            <ul id="volumes"></ul>
         </div>

      </div>


      <footer>
         <div class="footer">Â©Copyrighted EsNovels</div>
      </footer>
   </div>
   <!-- Jquery Implementation -->
   <script src="https://esdeguinio7.github.io/EsNovels1/jquery-3.7.1.min.js"></script>
   <script src="https://esdeguinio7.github.io/EsNovels1/script.js"></script>
   <script>
      $(document).ready(function() {

         function getQueryParam(key) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(key);
         }
         const id = getQueryParam("id");

         async function getNovelInfo() {
            const response = await fetch('https://esdeguinio7.github.io/EsNovels1/data.json');
            if (!response.ok) {
               throw new Error('Failed to fetch information or data not found');
            }
            const data = await response.json();
            return data;
         }

         getNovelInfo()
            .then(data => {
               const result = data.data;

               const titlePage = "Download " + result[id].title + " " + result[id].type;
               document.title = titlePage;

               const pageTitle = result[id].title + " " + result[id].type;
               const pageReplace = pageTitle.replaceAll(" ", "-");
               const pageUrl = "<meta name=\"url\" content=\"https://esdeguinio7.github.io/EsNovels1/page/" + pageReplace + "\"/>";
               $('head').append(pageUrl);

               $('#cover').attr('src', result[id].cover);
               $('#title').text(result[id].title);
               $('#type').text(result[id].type);
               $('#genres').text(result[id].genres);
               $('#synopsis').html(result[id].synopsis);
               const volumes = result[id].volumes;
               volumes.forEach((vol) => {
                  const param = "<li id='volume-position' data-src='" + vol.link + "' target='_blank'><p>" + vol.title + "</p></li>";
                  $('#volumes').append(param);
               });

            })
            .catch(error => console.log(error));

         $('#addToFav').click(function() {

            let values = {
               "title": $('#title').text(),
               "cover": $('#cover').attr('src'),
               "type": $('#type').text(),
               "genres": $('#genres').text(),
               "synopsis": $('#synopsis').text(),
               volumes: []
            }


            $('#volumes li').each(function(event) {
               let valueList = $(this).text();
               let valueSrc = $(this).attr('data-src');

               let pushData = { "title": valueList, "link": valueSrc }
               const contract = values.volumes;
               contract.push(pushData);
            });
            concontract(values);
            localStorage.setItem('myFav', JSON.stringify(values));
         });
      });
   </script>
</body>